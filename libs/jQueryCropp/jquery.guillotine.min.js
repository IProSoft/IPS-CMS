/*
 * jQuery Guillotine Plugin v1.2.0
 * http://matiasgagliano.github.com/guillotine/
 *
 * Copyright 2014, Mat√≠as Gagliano.
 * Dual licensed under the MIT or GPLv3 licenses.
 * http://opensource.org/licenses/MIT
 * http://opensource.org/licenses/GPL-3.0
 *
 */

(function(){"use strict";var t,i,e,h,n,s,o,r,a,u,l,f,d,c=[].indexOf||function(t){for(var i=0,e=this.length;i<e;i++){if(i in this&&this[i]===t)return i}return-1},p=function(t,i){return function(){return t.apply(i,arguments)}};t=jQuery;u="guillotine";l="guillotine";n={start:"touchstart."+l+" mousedown."+l+" MSPointerDown."+l,move:"touchmove."+l+" mousemove."+l+" MSPointerMove."+l,stop:"touchend."+l+" mouseup."+l+" MSPointerUp."+l};h={width:400,height:300,zoomStep:.1,init:null,eventOnChange:null,onChange:null};a=function(t){return t.type.search("touch")>-1};r=function(){return c.call(window,"MSPointerEvent")>=0};f=function(t){if(r()||!a(t)){f=function(t){return t.which!=null&&t.which===1}}else{f=function(){var i,e;return((i=t.originalEvent)!=null?(e=i.touches)!=null?e.length:void 0:void 0)===1}}return f(t)};s=function(t){if(r()||!a(t)){s=function(t){return{x:t.pageX,y:t.pageY}}}else{s=function(t){t=t.originalEvent.touches[0];return{x:t.pageX,y:t.pageY}}}return s(t)};e=function(){var t,i,h,n,s,o,r,a,u,l;t=false;n="webkit,Moz,O,ms,Khtml".split(",");r={transform:"transform"};for(u=0,l=n.length;u<l;u++){h=n[u];r[h+"Transform"]="-"+h.toLowerCase()+"-transform"}i=document.createElement("img");document.body.insertBefore(i,null);for(o in r){s=r[o];if(i.style[o]===void 0){continue}i.style[o]="rotate(90deg)";a=window.getComputedStyle(i).getPropertyValue(s);if(a!=null&&a.length&&a!=="none"){t=true;break}}document.body.removeChild(i);e=t?function(){return true}:function(){return false};return e()};o=function(i){return t(i).css({"-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})};i=function(){function i(i,e){this._drag=p(this._drag,this);this._unbind=p(this._unbind,this);this._start=p(this._start,this);var s;this.op=t.extend(true,{},h,e,t(i).data(u));this.enabled=true;this.zoomInFactor=1+this.op.zoomStep;this.zoomOutFactor=1/this.zoomInFactor;s=[0,0,0,0,0],this.width=s[0],this.height=s[1],this.left=s[2],this.top=s[3],this.angle=s[4];this.data={scale:1,angle:0,x:0,y:0,w:this.op.width,h:this.op.height};this._wrap(i);if(this.op.init!=null){this._init()}if(this.width<1||this.height<1){this._fit()&&this._center()}o(this.$el);this.$el.on(n.start,this._start)}i.prototype._wrap=function(i){var e,h,n,s,o,r,a,u,l,f;h=t(i);if(h.prop("tagName")==="IMG"){o=document.createElement("img");o.src=h.attr("src");u=[o.width,o.height],a=u[0],s=u[1]}else{l=[h.width(),h.height()],a=l[0],s=l[1]}f=[a/this.op.width,s/this.op.height],this.width=f[0],this.height=f[1];e=t("<div>").addClass("guillotine-canvas");e.css({width:this.width*100+"%",height:this.height*100+"%",top:0,left:0});e=h.wrap(e).parent();r=this.op.height/this.op.width*100+"%";n=t("<div>").addClass("guillotine-window");n.css({width:"100%",height:"auto","padding-top":r});n=e.wrap(n).parent();this.$el=h;this.el=h[0];this.$canvas=e;this.canvas=e[0];this.$gllt=n;this.gllt=n[0];return this.$document=t(i.ownerDocument)};i.prototype._unwrap=function(){this.$el.removeAttr("style");this.$el.insertBefore(this.gllt);return this.$gllt.remove()};i.prototype._init=function(){var t,i,e;i=this.op.init;if(t=parseInt(i.angle)){this._rotate(t)}if(e=parseFloat(i.scale)){this._zoom(e)}return this._offset(parseInt(i.x)/this.op.width,parseInt(i.y)/this.op.height)};i.prototype._start=function(t){if(!(this.enabled&&f(t))){return}t.preventDefault();t.stopImmediatePropagation();this.p=s(t);return this._bind()};i.prototype._bind=function(){this.$document.on(n.move,this._drag);return this.$document.on(n.stop,this._unbind)};i.prototype._unbind=function(t){this.$document.off(n.move,this._drag);this.$document.off(n.stop,this._unbind);if(t!=null){return this._trigger("drag")}};i.prototype._trigger=function(t){if(this.op.eventOnChange!=null){this.$el.trigger(this.op.eventOnChange,[this.data,t])}if(typeof this.op.onChange==="function"){return this.op.onChange.call(this.el,this.data,t)}};i.prototype._drag=function(t){var i,e,h,n,o;t.preventDefault();t.stopImmediatePropagation();n=s(t);i=n.x-this.p.x;e=n.y-this.p.y;this.p=n;h=i===0?null:this.left-i/this.gllt.clientWidth;o=e===0?null:this.top-e/this.gllt.clientHeight;return this._offset(h,o)};i.prototype._offset=function(t,i){if(t||t===0){if(t<0){t=0}if(t>this.width-1){t=this.width-1}this.canvas.style.left=(-t*100).toFixed(2)+"%";this.left=t;this.data.x=Math.round(t*this.op.width)}if(i||i===0){if(i<0){i=0}if(i>this.height-1){i=this.height-1}this.canvas.style.top=(-i*100).toFixed(2)+"%";this.top=i;return this.data.y=Math.round(i*this.op.height)}};i.prototype._zoom=function(t){var i,e,h,n,s;if(t<=0||t===1){return}s=[this.width,this.height],n=s[0],i=s[1];if(n*t>1&&i*t>1){this.width*=t;this.height*=t;this.canvas.style.width=(this.width*100).toFixed(2)+"%";this.canvas.style.height=(this.height*100).toFixed(2)+"%";this.data.scale*=t}else{this._fit();t=this.width/n}e=this.left+n*(t-1)/2;h=this.top+i*(t-1)/2;return this._offset(e,h)};i.prototype._fit=function(){var t,i;t=this.width;i=this.height/this.width;if(i>1){this.width=1;this.height=i}else{this.width=1/i;this.height=1}this.canvas.style.width=(this.width*100).toFixed(2)+"%";this.canvas.style.height=(this.height*100).toFixed(2)+"%";return this.data.scale*=this.width/t};i.prototype._center=function(){return this._offset((this.width-1)/2,(this.height-1)/2)};i.prototype._rotate=function(t){var i,h,n,s,o,r,a;if(!e()){return}if(!(t!==0&&t%90===0)){return}this.angle=(this.angle+t)%360;if(this.angle<0){this.angle=360+this.angle}if(t%180!==0){h=this.op.height/this.op.width;o=[this.height*h,this.width/h],this.width=o[0],this.height=o[1];if(this.width>=1&&this.height>=1){this.canvas.style.width=this.width*100+"%";this.canvas.style.height=this.height*100+"%"}else{this._fit()}}r=[1,1],s=r[0],n=r[1];if(this.angle%180!==0){i=this.height/this.width*h;a=[i,1/i],s=a[0],n=a[1]}this.el.style.width=s*100+"%";this.el.style.height=n*100+"%";this.el.style.left=(1-s)/2*100+"%";this.el.style.top=(1-n)/2*100+"%";this.$el.css({transform:"rotate("+this.angle+"deg)"});this._center();return this.data.angle=this.angle};i.prototype.rotateLeft=function(){return this.enabled&&(this._rotate(-90),this._trigger("rotateLeft"))};i.prototype.rotateRight=function(){return this.enabled&&(this._rotate(90),this._trigger("rotateRight"))};i.prototype.center=function(){return this.enabled&&(this._center(),this._trigger("center"))};i.prototype.fit=function(){return this.enabled&&(this._fit(),this._center(),this._trigger("fit"))};i.prototype.zoomIn=function(){return this.enabled&&(this._zoom(this.zoomInFactor),this._trigger("zoomIn"))};i.prototype.zoomOut=function(){return this.enabled&&(this._zoom(this.zoomOutFactor),this._trigger("zoomOut"))};i.prototype.getData=function(){return this.data};i.prototype.enable=function(){return this.enabled=true};i.prototype.disable=function(){return this.enabled=false};i.prototype.remove=function(){this._unbind();this._unwrap();this.disable();this.$el.off(n.start,this._start);return this.$el.removeData(u+"Instance")};return i}();d=["rotateLeft","rotateRight","center","fit","zoomIn","zoomOut","instance","getData","enable","disable","remove"];t.fn[u]=function(e){if(typeof e!=="string"){return this.each(function(){var h;if(!t.data(this,u+"Instance")){h=new i(this,e);return t.data(this,u+"Instance",h)}})}else if(c.call(d,e)>=0){if(e==="instance"){return t.data(this[0],u+"Instance")}if(e==="getData"){return t.data(this[0],u+"Instance")[e]()}return this.each(function(){var i;i=t.data(this,u+"Instance");if(i){return i[e]()}})}}}).call(this);